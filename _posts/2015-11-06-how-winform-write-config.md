---
layout: post
title: 解决WinForm程序在安装以后无法读写config文件的问题
date: 2015-11-06 07:01:24
categories: 技术
tags: UAC Windows WinForm dotnet
---

这个问题有两个解决方案，一个方案是将Config文件放到有权限读写的位置，另一个方案是提升运行程序的权限。第一个方案可以完美解决这个问题，用户体验最好，但是解决起来稍显复杂，安装程序和代码中都需要特殊处理。第二个方案有点投机取巧，一般情况下没有什么问题，但是在域环境下当前用户不是本机管理员的情况下，提升权限可能会失败，会提示输入有权限的用户的用户名和密码。

使WinForm提升权限，需要在这个WinForm的项目中，添加一个应用程序清单文件，如下图。

![](/images/2015/11/image.png)

在添加完这个文件之后，还需要修改这个文件的一行，如下图的样子：

![](/images/2015/11/image1.png)

这一行修改完成重新编译即可。

如果在VS中直接运行的时候，当前VS不是以管理员身份执行的话，会提示你VS当前的权限不够，并重新以管理员的身份启动，在运行这个程序。如果是已经安装好的程序，就会出现大家很常见的UAC的提升权限提示了。
